<!DOCTYPE html>
<html>
<head>
    <title>Cricket Match Details</title>
    <!-- Include Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-image: url('https://img.freepik.com/free-photo/wall-wallpaper-concrete-colored-painted-textured-concept_53876-31799.jpg?w=996&t=st=1686117285~exp=1686117885~hmac=d06d7febcd38039bae20a4bb6971830c0db6b50bdb111f3d8df64129f5df7573');
            background-size: cover;
            background-position: center;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .form-container {
            max-width: 400px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .form-container h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .form-group label {
            font-weight: bold;
        }

        .btn-primary {
            width: 100%;
        }

        #result-container {
            margin-top: 20px;
            text-align: center;
        }
    </style>
    <style>
        #cricket-container {
            position: relative;
        }
    
        #error-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
        }
    
        .alert {
            padding: 10px;
            margin-bottom: 10px;
            background-color: #d3eaf4;
            color: #31708f;
        }
    
        .alert button.close {
            float: right;
        }
    
        .alert strong {
            font-weight: bold;
        }
    </style>
    
</head>
<body>
    <div id="cricket-container">
    <div id="error-container"></div>
        <div class="form-container">
            <h2>Cricket Match Details</h2>
            <form id="cricket-form" method="POST">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
            <div id="result-container"></div>
            <div id="error-messages"></div>
        </div>
    </div>
    <!-- Include Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#cricket-form").submit(function (e) {
                e.preventDefault(); // Prevent the form from submitting normally
    
                // Serialize the form data
                var formData = $(this).serialize();
    
                // Send the AJAX request
                $.ajax({
                    type: "POST",
                    url: "/cricket-match-details/", // URL pattern defined in urls.py
                    data: formData,
                    success: function (response) {
                        // Display the result in the result-container div
                        $("#result-container").html("<p>Par Score: " + response.result + "</p>");
                        $("#error-container").empty(); // Clear any previous error messages
                    },
                    error: function (xhr, status, error) {
                        if (xhr.status === 400) {
                            var errorData = JSON.parse(xhr.responseJSON.errors);
    
                            // Loop through the errors and create disposable alerts
                            for (var key in errorData) {
                                if (errorData.hasOwnProperty(key)) {
                                    var fieldName = key.replace(/_/g, " "); // Convert underscores to spaces
                                    var errorMessage = errorData[key][0].message;
    
                                    // Create the alert element with close button
                                    var alertElement = $("<div>").addClass("alert alert-dismissible alert-danger");
                                    var closeButton = $("<button>").addClass("close").attr("type", "button").html("&times;");
                                    var fieldNameElement = $("<strong>").text(fieldName);
                                    var errorMessageElement = $("<span>").text(errorMessage);
    
                                    // Append the elements to the alert
                                    alertElement.append(closeButton, "<br>", fieldNameElement, "<br>", errorMessageElement);
    
                                    // Append the alert to the error container
                                    $("#error-container").append(alertElement);
    
                                    // Attach event handler to the close button to remove the alert when clicked
                                    closeButton.click(function () {
                                        $(this).parent().remove();
                                    });
                                }
                            }
                        } else {
                            console.error(xhr.responseText);
                        }
                    },
                });
            });
        });
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
